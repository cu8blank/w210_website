<!DOCTYPE html>
<!--
	Transit by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html lang="en">
	<head>

		<meta charset="UTF-8">
		<title>Tourist Concierge</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
		</noscript>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<!-- Pym.js - iframe height handler for the Blog -->
		<script src="js/pym.min.js"></script>
		
		<link rel="stylesheet" href="css/theconcierge.css" />

		<script type="text/javascript" src="js/d3.min.js"></script>
		<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
		<!--link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" /-->
		<link rel="stylesheet" type="text/css" href="css/keen-dashboards.css" />
		
        <!-- map file should be included after ammap.js -->
		<link rel="stylesheet" type="text/css" href="css/ammap.css" />
        <script src="js/ammap.js" type="text/javascript"></script>			
		<script src="js/worldLow.js" type="text/javascript"></script>		
		
		<script src="js/map.js"></script>
        <script type="text/javascript">

			//*****Main function that drives the graphs and forecasts....
			
			var graph_select = 'Safety';
			
			function CountrySelect (tar_country) {			
			
			
			/************************** Display Recommendations******************************/
				
				/***Main data file loaded, used for everything **/
				var data = $.getJSON('data/finale.json', function(data) {
						console.log( "data_success" );				
				
				
				var raw_data = get_data(tar_country, data);
							
				//***Helper function to get the data for the selected country**//	
				function get_data(name, data) {
					for (var i = 0, len = data.length; i < len; i++) {
						if (data[i]["country_code"] == name)										
						return data[i]; // Return as soon as the object is found
						}
				return null;
					};
				
				
				/***Get random safer and cheaper countries**/					
						
				
						
				//list of cheaper countries
				var cheaper = $.grep(data, function( n, i ) {
					return n.cluster_id == raw_data.cluster_id && n.price < raw_data.price && n.price != null  
				});
						
				//randomly select cheaper country - not same country as safest
				if (raw_data.price == null) {
					var randcheap_name = ['No Data']
				} else if (cheaper.length == 0) {
					var randcheap_name = ['No Data']
				}else {
					 
					var randcheap = cheaper.sort( function() { return 0.5 - Math.random() } )
					if (cheaper.length === 1) {					
					var randcheap_name = [randcheap[0].Name]
					} else {
					var randcheap_name = [randcheap[0].Name,randcheap[1].Name]
					}
				};
						

				//get list of safer countries
				var safer = $.grep(data, function( n, i ) {
					return n.cluster_id == raw_data.cluster_id && n.curr_week_pct_4 < raw_data.curr_week_pct_4 && raw_data.Name != randcheap_name[0] 
				});
						
				//randomly select two countries
				if (safer.length === 0) {
					var randsafe = 'No Safer Country'
				}else {					
					var randsafe = safer.sort( function() { return 0.5 - Math.random() } )
					if (safer.length === 1) {					
					var randsafe_name = [randsafe[0].Name]
					} else {
					var randsafe_name = [randsafe[0].Name,randsafe[1].Name]
					}
										
					
				};



						
					/***END Get one random safer and cheaper country**/
                                     
                                     
                    // Display the Selected Country in the summary table- prepend to the top
                   
                   if (raw_data.allowed_stay == null) {
                            raw_data.allowed_stay = "";
                    }
                                     
                    if (raw_data.price_r == null) {
                            raw_data.price_r = "NA";
                    }
                                     
                    if (raw_data.curr_week_pct_4_r == null) {
                                     curr_week_pct_4_r = "NA";
                    }
                                     
                   html_string = "";
                   html_string += "<tr class='saru' style= 'background-color:#ffffaa;'><td class = 'title' data-toggle='tooltip' title='Click on country name to deselect'>" + raw_data.Name + "<td class = 'center'>" + raw_data.attraction_rating + "</td><td class = 'center'>" + raw_data.curr_week_pct_4_r + "</td><td class = 'center'>" + raw_data.price_r + "</td><td class = 'right'>" + raw_data.att_str + "</td><td class = 'left'>" + raw_data.visa_req + "</td><td class = 'right'>" + raw_data.allowed_stay + "</td><td><input type='button' class='remove' value='x'></td></tr>";
                   
                                     
                    $(html_string).prependTo("table#sumtable > tbody");
                                     
                                     
                    // Add rowhandler
                    addRowHandlers();

					/***Display Cheaper and Safer Country**/
					
					var country_title = d3.select("#rec_title")													
													.text(" Similar to " + raw_data.Name + "....")												
													.attr("align","center")
													.style("font-style","italic");

					//creates array for displaying cheaper and safer country.  if its empty, then nothing is appended.
					var output = [];
					
					if (randsafe_name  != null) {
						output.push(["...but safer.", "desc"]);
						output.push([randsafe_name[0], "cty"]);
					if (randsafe_name.length ==2) {
						output.push([randsafe_name[1], "cty"]);
					}
						
					};
										
					if (randcheap_name  != 'No Data') {
						output.push(["...but cheaper.", "desc"]);
						output.push([randcheap_name[0], "cty"])	
					if (randcheap_name.length ==2) {
						output.push([randcheap_name[1], "cty"]);
					}
						
					};
										
					d3.selectAll("#recs > *").remove()					
					
					var table = d3.select("#recs")
											.append("table")
											//.attr("class", "table-condensed"),											
											tbody = table.append("tbody");
											
					var rows = tbody.selectAll("tr")
								.data(output)
								.enter()
								.append("tr")
								.text(function(d){return d[0]})
								.attr("class", function(d){return d[1]})
								.on("click", function(d) {
                                    CountrySelect(countries[d[0]]);
                                    map.clickMapObject(map.getObjectById(countries[d[0]]));
                                    
                                });
								
					/***END Display Cheaper and Safer Country**/							
						

				/************************** Display Country Table ******************************/

						//Function checks if there is a value for curr, returns no data if null
						function no_data(value) {
							if (value == null) {
								return 'No Data'
							}else { return value}
						
						};
			
						//Function returns data in format to be used by table
						function format_data(country,data) {
							var raw_data = data;
							var safety = ['Safety Score', raw_data.curr_week_pct_4.toFixed(1)];
							var curr = ['Exchange Rate',no_data(raw_data.rate_curr)];
							
							var safetypred = [raw_data.pred_1_week, raw_data.pred_1_month, raw_data.pred_3_months];
							var currpred = [raw_data.rate_7, raw_data.rate_30, raw_data.rate_90];
							
							
							
							for (var i = 0, len = 3; i < len; i++) {		
								if ((raw_data.curr_week_pct_4/10).toFixed(0)-safetypred[i] == 0){
										safety.push('Minimal Change')		
								}else if ((raw_data.curr_week_pct_4/10).toFixed(0)-safetypred[i] == 1){
										safety.push('Decrease')	
								}else if ((raw_data.curr_week_pct_4/10).toFixed(0)-safetypred[i] == -1){
										safety.push('Increase')
								}else if ((raw_data.curr_week_pct_4/10).toFixed(0)-safetypred[i] > 1){
										safety.push('Large Decrease')	
								}else {
										safety.push('Large Increase');		
								};
							
		
								if (currpred[i] == null) {
									curr.push('No Data')																
								}else if ( (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) <= 0.025 ) && (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) >= - 0.025 )) {
									curr.push('Minimal Change')	
								}else if ( (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) < 0.05 ) && (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) > 0.025 )) {
									curr.push('Decrease')	
								}else if ( (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) < -0.025 ) && (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) > -0.05 )) {
									curr.push('Increase')	
								}else if ( (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) >= 0.05 )) {
									curr.push('Large Decrease')	
								}else if ( (((raw_data.rate_curr - currpred[i]) / raw_data.rate_curr  ) <= -0.05 ) ) {
									curr.push('Large Increase')	
								};
							
							};
							
							var country_data =[safety,curr];
							  
							var table = d3.select("#forecast_table")
							var rows = table.selectAll("tbody tr")
							.data(country_data)
							.attr("id",function(d) { return d[0][0]; });
						 
							// add new rows
							rows.enter().append("tr")										
									.selectAll("td")
									.data(function(d) { return d; })
								    .enter()
									.append("td");
						 
							// insert/update existing rows
							rows.selectAll("td")
									.data(function(d) { return d; })
									.text(function(d) { return d; });
						 
							// delete missing rows off the end of the table
							rows.exit()
									.remove();		

							return [safety,curr]
						
						};

						var country_data = format_data(tar_country,raw_data);
						
						var country_title = d3.select("#forecast_table_title")													
													.text("Forecasted Changes for " + raw_data.Name)													
													.attr("align","center");
													
													
													
					//parse currency to put in footer
					
					
					
					
					if (raw_data.currency != null) {
					
					var curr_type = raw_data.currency;				
					var curr_parse =  curr_type.substring(curr_type.length-4,curr_type.length-1);
					var footer =  "Exchange Rate represents " + curr_parse + " to USD";
												
					var footer = d3.select("#forecast_footer")
							.text(footer)							
							.attr("text-anchor", "middle");							
							
					
					} else {
					var footer = d3.select("#forecast_footer")
							.text('')							
							.attr("text-anchor", "middle");	
                    };
	
					
				//***Helper function to get the data for the selected country**//	
				function get_data_gdelt_hist(name, data) {
					for (var i = 0, len = 175; i < len; i++) {
						if (data[i]["key"] == name)										
							return data[i]; // Return as soon as the object is found
							}
						return null;
							};									
					
				//function to return dates and scores and name of country for gdelt hist
				function scores(data, period)  {
					var scores =[]
						for (var i = 53 - period, len = 53; i < len; i++) {									
							week = new Date(data.values[i].date*1000);							
							score = data.values[i].roll_pct;
									
							scores.push({'Name':data.values[i].Name, 'Week':week,'Score':score})									
										
							}
						return scores;
						};
				//function to return dates and scores and name of country for curr hist		
				function curr_scores(data, period)  {
					var scores =[]
						for (var i = data.length - period, len = data.length; i < len; i++) {
		;				
							week = new Date(data.values[i].date*1000);							
							score = data.values[i].roll_pct;
									
							scores.push({'Name':data.values[i].Name, 'Week':week,'Score':score})									
										
							}
						return scores;
						};
							
				
				function safety_graph() {
				
				//switches the colors on the forecast table
				d3.select('#S').attr("class","graph_select");
				d3.select('#E').attr("class","graph_unselect");
				
				
				var gdelt_hist_data = $.getJSON('data/gdelt_hist.json', function(data) {
													
					
				//reorders the data for loading later
				var dataGroup = d3.nest()
					.key(function(d) {
					return d.country_code;
						})
					.entries(gdelt_hist_data.responseJSON);		
				
				
				//Title
				var graph_title = d3.select("#graph_title")													
													.text("Historical Safety Graph for " + raw_data.Name )												
													.attr("align","center")	;
				//dataset for the selected country
				var raw_data_gdelt = get_data_gdelt_hist(tar_country, dataGroup);
				
				
				
				
				
				//dataset for median - in flat file		
				var med_gdelt = get_data_gdelt_hist("Med", dataGroup);
				
				//main data to be graphed.
					
				//variable to set how many weeks back to go
				back = 26
					
				//get subset for main, random safer and median
				curr_stab_scores = scores(raw_data_gdelt,back);
				
				
				
				med_scores = scores(med_gdelt,back);

				
				var dateformat = d3.time.format("%b %Y")	;
				
			
				
				var dataset=['Switch to Currency History'];				
				//begin chart vis
				
					//removes the current vis and puts in a blank canvas.  necessary when a new country is clicked on	
					d3.selectAll("#graphs > *").remove()			
					
					var svg = d3.select("#graphs").append("svg").attr("id","visualisation");
					svg.attr('width',parseInt(d3.select('#graphs').style('width')));
					svg.attr('height',parseInt(d3.select('#graphs').style('height')));
							
					
					//button to click to currency
					var click = svg.selectAll("rect")
						.data(dataset)
						.enter()
						.append("rect")
						.attr("x", 0)
						.attr("y", 0)
						.attr("width", 175)
						.attr("height", 20)
						.attr("fill", "teal")
						.attr("id", "click_rect")						
						.on('click', function(d,i){ currency_graph(); graph_select = 'Currency'; })
						.on("mouseover", function() {
							d3.select(this)
									.attr("fill", "yellow");
									})
						.on("mouseleave", function() {
							d3.select(this)
									.attr("fill", "teal");
									});
	
						svg.selectAll("text")
							.data(dataset)
							.enter()
							.append("text")
							.text(function(d) {
								return d;
							})
							.attr("y",15)
							.attr("x",5)		
							.style("font-weight","bold")						
							.on("mouseover", function() {
								d3.select("#click_rect")
									.attr("fill", "yellow");
									})
							.on("mouseleave", function() {
								d3.select("#click_rect")
									.attr("fill", "teal");
									})
							.on('click', function(d,i){ currency_graph(); graph_select = 'Currency';  });
	
	
	
	
					var vis = d3.select("#visualisation"),						
						MARGINS = {
							top: 15,
							right: 0,
							bottom: 30,
							left: 50
							},	
						 width = parseInt(d3.select('#graphs').style('width')),
						 width = width - MARGINS.left - MARGINS.right,
						 height = parseInt(d3.select('#graphs').style('height')) ,
						 height = height - MARGINS.top - MARGINS.bottom,
						 xScale = d3.time.scale()
								.range([MARGINS.left, width - MARGINS.right])
								.domain([curr_stab_scores[0].Week,curr_stab_scores[back-1].Week])
								
								,
						yScale = d3.scale.linear()
								.range([height - MARGINS.top, MARGINS.bottom])
								.domain([0, d3.max(curr_stab_scores.concat(med_scores), function(d) {
							return d.Score;
						})]),
						
						xAxis = d3.svg.axis()
							.scale(xScale)
							.tickFormat(dateformat),  
						yAxis = d3.svg.axis()
							.scale(yScale)
							.orient("left");			
						
					var x_axis = vis.append("svg:g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + (height) + ")")
						
                        .call(xAxis);
						
                    var y_axis = vis.append("svg:g")
                        .attr("class", "y axis")
                        .attr("transform", "translate(" + (MARGINS.left) + ",0)")
                        .call(yAxis);


						
					//y axis label
					var y_label = vis.append("text")
					.attr("text-anchor", "middle")  
					.attr("transform", "translate("+ (MARGINS.left/2) +","+(height/2)+")rotate(-90)") 
					
					.text("Safety Score");
						
					var lineFunc = d3.svg.line()
						.x(function(d) {
						return xScale(d.Week);
					})
						.y(function(d) {
						return yScale(d.Score);
					})
					.interpolate('linear');
					
					//main line
					var line_path = vis.append('svg:path')
						.attr('d', lineFunc(curr_stab_scores))
						.attr('fill', 'none')
						.attr('stroke', 'steelblue')
						.attr('stroke-width', '2px');
						
					//median line
					var med_line_path = vis.append('svg:path')
						.attr('d', lineFunc(med_scores))
						.attr('fill', 'none')
						.attr('stroke', 'red')
						.style("stroke-dasharray", ("3, 3"))
						.attr('stroke-width', '1.5px');

				});
				}
				
				function currency_graph() {
				
				//switches the colors on the forecast table
				d3.select('#E').attr("class","graph_select");
				d3.select('#S').attr("class","graph_unselect");
				
				var curr_hist_data = $.getJSON('data/curr_hist.json', function(data) {
												
					
				//reorders the data for loading later
				var dataGroup = d3.nest()
					.key(function(d) {
					return d.A2;
						})
					.entries(curr_hist_data.responseJSON);		
				
				
				
				currs=[]
				for (var i = 0, len = dataGroup.length; i < len; i++) {
				currs.push(dataGroup[i].key);
				};
				
				
				//Title
				var graph_title = d3.select("#graph_title")													
													.text("Historical Currency Graph for " + raw_data.Name )												
													.attr("align","center")	;
				//dataset for the selected country
				
				
				if(currs.indexOf(tar_country)>=0) {
				
				
				var raw_data_curr = get_data_gdelt_hist(tar_country, dataGroup);
				
				var dateformat = d3.time.format("%b %Y")	;
				
				//variable to set how many weeks back to go
				back = 26
					
				//get subset for main, random safer and median
								
				
					var curr_curr_scores =[]
					
					
						for (var i = raw_data_curr.values.length - back, len = raw_data_curr.values.length; i < len; i++) {
							week = new Date(raw_data_curr.values[i].date);							
							rate = raw_data_curr.values[i].USD_rate;
							curr_curr_scores.push({'Currency':raw_data_curr.values[i].currency_type, 'Week':week,'Rate':rate})									
										
							}
						
				} else {
				curr_curr_scores = ['No Historical Currency Data']
				};

				var dataset=['Switch to Safety History'];

				//begin chart vis
				
					//removes the current vis and puts in a blank canvas.  necessary when a new country is clicked on	
					d3.selectAll("#graphs > *").remove()			
					
					var svg = d3.select("#graphs").append("svg").attr("id","visualisation");
					svg.attr('width',parseInt(d3.select('#graphs').style('width')));
					svg.attr('height',parseInt(d3.select('#graphs').style('height')));
							
					
					//button to click to safety
					var click = svg.selectAll("rect")
						.data(dataset)
						.enter()
						.append("rect")
						.attr("x", 0)
						.attr("y", 0)
						.attr("width", 160)
						.attr("height", 20)
						.attr("fill", "teal")
						.attr("id", "click_rect")						
						.on('click', function(d,i){ safety_graph(); graph_select = 'Safety';  })
						.on("mouseover", function() {
							d3.select(this)
									.attr("fill", "yellow");
									})
						.on("mouseleave", function() {
							d3.select(this)
									.attr("fill", "teal");
									});
	
						svg.selectAll("text")
							.data(dataset)
							.enter()
							.append("text")
							.text(function(d) {
								return d;
							})
							.attr("y",15)
							.attr("x",5)		
							.style("font-weight","bold")						
							.on("mouseover", function() {
								d3.select("#click_rect")
									.attr("fill", "yellow");
									})
							.on("mouseleave", function() {
								d3.select("#click_rect")
									.attr("fill", "teal");
									})
							.on('click', function(d,i){ safety_graph(); graph_select = 'Safety';  });
					

					
					if (curr_curr_scores !='No Historical Currency Data') {
					
					
					//parse currency to put on y axis
					var curr_type = raw_data_curr.values[0].currency_type;				
					var curr_parse =  curr_type.substring(curr_type.length-4,curr_type.length-1);
					var yaxislabel = curr_parse + " to USD"
	
					
	
					var vis = d3.select("#visualisation"),						
						MARGINS = {
							top: 15,
							right: 0,
							bottom: 30,
							left: 50
							},	
						 width = parseInt(d3.select('#graphs').style('width'), 10),
						 width = width - MARGINS.left - MARGINS.right,
						 height = parseInt(d3.select('#graphs').style('height'), 10) ,
						 height = height - MARGINS.top - MARGINS.bottom,
						 xScale = d3.time.scale()
								.range([MARGINS.left, width - MARGINS.right])
								.domain([curr_curr_scores[0].Week,curr_curr_scores[back-1].Week])
								//.tickFormat(d3.time.format('%H'))
								,
						yScale = d3.scale.linear()
								.range([height - MARGINS.top, MARGINS.bottom])
								.domain([d3.min(curr_curr_scores, function(d) {
							return d.Rate;
						}), d3.max(curr_curr_scores, function(d) {
							return d.Rate;
						})]),
						
						xAxis = d3.svg.axis()
							.scale(xScale)
							.tickFormat(dateformat),  
						yAxis = d3.svg.axis()
							.scale(yScale)
							.orient("left");			
						
					var x_axis = vis.append("svg:g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + (height) + ")")
                        .call(xAxis);
						
                    var y_axis = vis.append("svg:g")
                        .attr("class", "y axis")
                        .attr("transform", "translate(" + (MARGINS.left) + ",0)")
                        .call(yAxis);

					//y axis label
					var y_label = vis.append("text")
					.attr("text-anchor", "middle")  
					.attr("transform", "translate("+ (MARGINS.left/4) +","+(height/2)+")rotate(-90)") 
					
					.text(yaxislabel);
						
						
					var lineFunc = d3.svg.line()
						.x(function(d) {
						return xScale(d.Week);
					})
						.y(function(d) {
						return yScale(d.Rate);
					})
					.interpolate('linear');
					
					//main line
					var line_path = vis.append('svg:path')
						.attr('d', lineFunc(curr_curr_scores))
						.attr('fill', 'none')
						.attr('stroke', 'steelblue')
						.attr('stroke-width', '2px');
						
				} else {
				
				
				
				svg.append("text")
							.text('No Historical Currency Data')
							.attr("y",parseInt(d3.select('#graphs').style('height'))/2.5)
							.attr("x",parseInt(d3.select('#graphs').style('width'))/2)
							.attr("text-anchor", "middle")							
							.style("font-weight","bold")
							.style("font-size","20px");
				};

				
				
					
				});
				};
				
				if (graph_select == 'Safety'){
				safety_graph();
				} else {
				currency_graph();
				};
						
					})
						.done(function() {
							console.log( "second success" );							
					})
						.fail(function() {
							console.log( "error" );
					})
						.always(function() {
							console.log( "complete" );
					});

			}
			

			//**** MAP LISTERNER BELOW ***////	
			
			//******* change this color for the zoomed in country *******//
			map.addListener("clickMapObject", function(event) {
				//alert("Map object id: " + event.mapObject.id + "\nMap object title: " + event.mapObject.title)
			    
			CountrySelect(event.mapObject.id);
				
			});
            
			/**
			//dict to convert country name to iso2
			
			var countries = (function () {
				var json = null;
				$.ajax({
					'async': false,
					'global': false,
					'url': 'data/country_name_iso2.json',
					'dataType': "json",
					'success': function (data) {
						json = data;
					}
				});
				return json;
			})();
			**/
			
			countries = {'Afghanistan': 'AF',
 'Albania': 'AL',
 'Algeria': 'DZ',
 'Angola': 'AO',
 'Antigua and Barbuda': 'AG',
 'Argentina': 'AR',
 'Armenia': 'AM',
 'Australia': 'AU',
 'Austria': 'AT',
 'Azerbaijan': 'AZ',
 'Bahamas': 'BS',
 'Bahrain': 'BH',
 'Bangladesh': 'BD',
 'Barbados': 'BB',
 'Belarus': 'BY',
 'Belgium': 'BE',
 'Belize': 'BZ',
 'Benin': 'BJ',
 'Bermuda': 'BM',
 'Bhutan': 'BT',
 'Bolivia': 'BO',
 'Botswana': 'BW',
 'Brazil': 'BR',
 'Brunei Darussalam': 'BN',
 'Bulgaria': 'BG',
 'Burkina Faso': 'BF',
 'Burundi': 'BI',
 'Cambodia': 'KH',
 'Cameroon': 'CM',
 'Canada': 'CA',
 'Central African Republic': 'CF',
 'Chad': 'TD',
 'Chile': 'CL',
 'China': 'CN',
 'Colombia': 'CO',
 'Comoros': 'KM',
 'Costa Rica': 'CR',
 'Croatia': 'HR',
 'Cuba': 'CU',
 'Cyprus': 'CY',
 'Czech Republic': 'CZ',
 'Democratic Republic of the Congo': 'CD',
 'Denmark': 'DK',
 'Djibouti': 'DJ',
 'Dominican Republic': 'DO',
 'Ecuador': 'EC',
 'Egypt': 'EG',
 'El Salvador': 'SV',
 'Equatorial Guinea': 'GQ',
 'Eritrea': 'ER',
 'Estonia': 'EE',
 'Ethiopia': 'ET',
 'Fiji': 'FJ',
 'Finland': 'FI',
 'France': 'FR',
 'Gabon': 'GA',
 'Gambia': 'GM',
 'Georgia': 'GE',
 'Germany': 'DE',
 'Ghana': 'GH',
 'Greece': 'GR',
 'Grenada': 'GD',
 'Guatemala': 'GT',
 'Guinea': 'GN',
 'Guinea-Bissau': 'GW',
 'Guyana': 'GY',
 'Haiti': 'HT',
 'Holy See (Vatican City State)': 'VA',
 'Honduras': 'HN',
 'Hungary': 'HU',
 'Iceland': 'IS',
 'India': 'IN',
 'Indonesia': 'ID',
 'Iran': 'IR',
 'Iraq': 'IQ',
 'Ireland': 'IE',
 'Israel': 'IL',
 'Italy': 'IT',
 'Jamaica': 'JM',
 'Japan': 'JP',
 'Jordan': 'JO',
 'Kazakhstan': 'KZ',
 'Kenya': 'KE',
 'Kuwait': 'KW',
 'Kyrgyzstan': 'KG',
 'Laos': 'LA',
 'Latvia': 'LV',
 'Lebanon': 'LB',
 'Lesotho': 'LS',
 'Liberia': 'LR',
 'Libya': 'LY',
 'Liechtenstein': 'LI',
 'Lithuania': 'LT',
 'Luxembourg': 'LU',
 'Macedonia': 'MK',
 'Madagascar': 'MG',
 'Malawi': 'MW',
 'Malaysia': 'MY',
 'Maldives': 'MV',
 'Mali': 'ML',
 'Malta': 'MT',
 'Mauritania': 'MR',
 'Mexico': 'MX',
 'Micronesia': 'FM',
 'Moldova': 'MD',
 'Monaco': 'MC',
 'Mongolia': 'MN',
 'Morocco': 'MA',
 'Mozambique': 'MZ',
 'Myanmar': 'MM',
 'Namibia': 'NA',
 'Nepal': 'NP',
 'Netherlands': 'NL',
 'New Zealand': 'NZ',
 'Nicaragua': 'NI',
 'Niger': 'NE',
 'Nigeria': 'NG',
 'North Korea': 'KP',
 'Norway': 'NO',
 'Oman': 'OM',
 'Pakistan': 'PK',
 'Panama': 'PA',
 'Papua New Guinea': 'PG',
 'Paraguay': 'PY',
 'Peru': 'PE',
 'Philippines': 'PH',
 'Poland': 'PL',
 'Portugal': 'PT',
 'Qatar': 'QA',
 'Romania': 'RO',
 'Russia': 'RU',
 'Rwanda': 'RW',
 'Saint Kitts and Nevis': 'KN',
 'Saint Lucia': 'LC',
 'Saudi Arabia': 'SA',
 'Senegal': 'SN',
 'Serbia': 'RS',
 'Sierra Leone': 'SL',
 'Singapore': 'SG',
 'Slovakia': 'SK',
 'Somalia': 'SO',
 'South Africa': 'ZA',
 'South Korea': 'KR',
 'Spain': 'ES',
 'Sri Lanka': 'LK',
 'Sudan': 'SD',
 'Suriname': 'SR',
 'Swaziland': 'SZ',
 'Sweden': 'SE',
 'Switzerland': 'CH',
 'Syria': 'SY',
 'Taiwan': 'TW',
 'Tajikistan': 'TJ',
 'Tanzania': 'TZ',
 'Thailand': 'TH',
 'Timor-Leste': 'TL',
 'Togo': 'TG',
 'Trinidad and Tobago': 'TT',
 'Tunisia': 'TN',
 'Turkey': 'TR',
 'Turkmenistan': 'TM',
 'Uganda': 'UG',
 'Ukraine': 'UA',
 'United Arab Emirates': 'AE',
 'United Kingdom': 'GB',
 'Uruguay': 'UY',
 'Uzbekistan': 'UZ',
 'Venezuela': 'VE',
 'Vietnam': 'VN',
 'Yemen': 'YE',
 'Zambia': 'ZM',
 'Zimbabwe': 'ZW'};
			
            
			
            // SARUS CODE
            function toggleCheckbox(element)
            {

                //get season
                var checkboxes = document.getElementsByName('season');
                var checkboxesChecked = [];
                // loop over them all
                for (var i=0; i<checkboxes.length; i++) {
                    // And stick the checked ones onto an array...
                    if (checkboxes[i].checked) {
                        checkboxesChecked.push(checkboxes[i].value);
                    }
                }
                x= checkboxesChecked.length > 0 ? checkboxesChecked : [];
                
                // get tt
                var checkboxes_t = document.getElementsByName('tt');
                var checkboxesChecked_t = [];
                // loop over them all
                for (var i=0; i<checkboxes_t.length; i++) {
                    // And stick the checked ones onto an array...
                    if (checkboxes_t[i].checked) {
                        checkboxesChecked_t.push(checkboxes_t[i].value);
                    }
                }
                y= checkboxesChecked_t.length > 0 ? checkboxesChecked_t : [];
                
                //get at
                var checkboxes_at = document.getElementsByName('at');
                var checkboxesChecked_at = [];
                // loop over them all
                for (var i=0; i<checkboxes_at.length; i++) {
                    // And stick the checked ones into an array...
                    if (checkboxes_at[i].checked) {
                        checkboxesChecked_at.push(checkboxes_at[i].value);
                    }
                }
                z= checkboxesChecked_at.length > 0 ? checkboxesChecked_at : [];
   
                //call a function to pass the checked values to summary
                filternow(x,y,z)
     
            } //end function
        
        function filternow(filters,filtert,filterdt){
            d3.json("data/finale.json", function(data2) {
                    
                    //******* USER SEARCH FILTER*******//
                    //if all 3 filters are empty then return nothing
                    if( filters.length<1 && filtert.length<1 && filterdt.length<1 ){
                        filtered_dt={}
                    }else{
                            //choose all countries that have at least 1 of the following filter tags
                            filtered_season = data2.filter(function(r){
                                result = 0; //start with false
                                //if no filters, return the row -- no restrictions
                                if(filters.length ==0){
                                    return 1;
                                }
                                                        
                                for(var i=0; i< filters.length; i++){
                                        result = result || r.top_season ==filters[i];
                                }
                                return result;
                     
                             }) //end filter_season
                           
                           //alert(JSON.stringify(filtered_season));
                           
                            //Now filter season results on travel type
                           //alert(JSON.stringify(filtert));
                           
                            filtered_tt = filtered_season.filter(function(r){
                                result = 0; //start with false
                                 //if no filters, return the row -- no restrictions
                                 if(filtert.length ==0){
                                    return 1;
                                 }
                                 for(var i=0; i< filtert.length; i++){
                                        result = result || r.top_tt == filtert[i]
                                 }
                                 return result;
                            }) //end filter_season
                          
                              //alert(JSON.stringify(filtered_tt))
                          
                              //Lastly filter dt on multiple activity types

                             filtered_dt = filtered_tt.filter(function(r){ //OR logic for the filterss
                                                result = 0; //start with false
                                                //if no filters, return the row -- no restrictions
                                                if(filterdt.length ==0){
                                                        return 1;
                                                }
                                                array = r.dt;
                                                var arr_val= eval(array);
                                                for(var i=0; i< filterdt.length; i++){
                                                        topic_no= parseInt(filterdt[i]);
                                                        
                                                        if(arr_val== null){ //some dt is null, dont return the row
                                                              return result;
                                                        }
                                                        else{
                                                              
                                                              result = result || arr_val[topic_no] >=0.20;
                                                        }
                                                }
                                                              
                                                return result;
                                                              
                              });
                            //sort by fun rating
                            filtered_dt = filtered_dt.sort(function(a, b) {
                                                           return parseFloat(b.excellent)-parseFloat(a.excellent) ;
                            });
                    }//end else
                    
                    //alert(JSON.stringify(filtered_dt));
                   // Create a function that returns a particular property of its parameter.
                   // If that property is a function, invoke it (and pass optional params).
                   function ƒ(name){
                    
                       var v,params=Array.prototype.slice.call(arguments,1);
                       return function(o){
                            return (typeof (v=o[name])==='function' ? v.apply(o,params) : v );
                       };
                    
                   }
                    
                    var columns = [
                    { head: 'Country', cl: 'title', html: ƒ('Name') },
                    { head: 'Attraction Rating', cl: 'center', html: ƒ('attraction_rating') },
					{ head: 'Safety Score', cl: 'center', html: ƒ('curr_week_pct_4_r') },
					{ head: 'Value Score', cl: 'center', html: ƒ('price_r') },
                    { head: 'Popular Activities', cl: 'right', html: ƒ('a_string') },
                    { head: 'Visa Requirements', cl: 'left', html: ƒ('visa_req') },
                    { head: 'Allowed Stay', cl: 'left', html: ƒ('allowed_stay') },
                    {head: 'Remove', cl: 'left', html: null }
                    ];
                    
                    // get the selected top rows before clearing the table
                    top_rows = [];
                    var sel_country = d3.select(".user_filter_list").select("table").selectAll(".saru td").each(function(){ // for each col of the sel row
                                                 this.__data__ = d3.select(this).text(); //remove text to get the whole td
                                                 top_rows.push(this.__data__);
                                                                                                                
                    });
                    
                    //alert(top_rows.length);
                    
                    var organized_top_rows= [];
                    for (i = 0; i <= top_rows.length; i++) {
                            if(i % 8 === 0){ // change to number of columns
                                    if(i != 0){
                                        organized_top_rows.push(one_row);
                                    }
                    
                                var one_row =[];
                            }
                        one_row.push(top_rows[i]);
                    }
                    
                    
                    
                   //Clear a table if exists
                   d3.select(".user_filter_list").html("");
                   // create table
				   
				   var sortAscending = true;
				   
                    var table = d3.select(".user_filter_list")
                        .append('table')
                        .attr("class", "table table-hover table-condensed")
                        .attr("id", "sumtable");


                    // create table header
                    table.append('thead').append('tr')
                        .selectAll('th')
                        .data(columns).enter()
                        .append('th')
                        .attr('class', ƒ('cl'))
                        .text(ƒ('head'))
						.on('click', function (d) {									
											
							header.attr('class', 'header');
	   
							if (sortAscending) { 
								rows.sort(function(a, b) { 
								return d3.ascending(a[d], b[d]); });
								sortAscending = false;
								this.className = 'aes';
	 
							} else {
								rows.sort(function(a, b) { return d3.descending(a[d], b[d]); });
								sortAscending = true;
								this.className = 'des';
							}
						});
						
					d3.select(".user_filter_list").selectAll("th:nth-child(1)")  //******* adding hover over table explanation
							.attr('data-title', "Country meeting user criteria");
					d3.select(".user_filter_list").selectAll("th:nth-child(2)")  
							.attr('data-title', "Average user rating of attractions in country");
					d3.select(".user_filter_list").selectAll("th:nth-child(3)")  
							.attr('data-title', "Current calculated safety score");
					d3.select(".user_filter_list").selectAll("th:nth-child(4)")  
							.attr('data-title', "Current cost of living score");
					d3.select(".user_filter_list").selectAll("th:nth-child(5)")  
							.attr('data-title', "Popular things to do in country");
					d3.select(".user_filter_list").selectAll("th:nth-child(6)")  
							.attr('data-title', "Visa requirements for country");
					d3.select(".user_filter_list").selectAll("th:nth-child(7)")  
							.attr('data-title', "Allowed duration of stay for visa");
							

                   // create table body
                   table.append('tbody')
                        .selectAll('tr')
                        .data(filtered_dt).enter()
                        .append('tr') //when tr is clicked give it a attribute
                        .attr("id","allrows")
                        .selectAll('td')
                        .data(function(row, i) {
                              if (row['at'].length>2){
                                  row['a_string']=row['att_str']
                              }else{
                                    row['a_string']= '';
                              }
                              
                              return columns.map(function(c) {
                                    // compute cell values for this specific row
                                    var cell = {};
                                    d3.keys(c).forEach(function(k) {
                                        cell[k] = typeof c[k] == 'function' ? c[k](row,i) : c[k];										
                                    });
                                    return cell;
                             });
                        }).enter()
                        .append('td')
                        .attr("data-toggle","tooltip")
                        .attr("title","Click the country name to select")
                        .on("click", function(d) { // when clicking any td, copy/past row info to top of row and delete the orig
                            
                                    //CountrySelect(countries[d.html]); //this prepends the data to the top
                                    console.log(countries[d.html]);
                            
                                    map.clickMapObject(map.getObjectById(countries[d.html])); // this will also select and highlight the clicked row's data
                                    // delete the row to avoid duplications
                                    //remove the table row that is clicked to avoid duplication
                                    //alert("DEleting FILTER!!!!");
                                    $(this).parent().remove();

                            
                                    /*
                                    $(".user_filter_list").on('click', "[id=allrows]", function(e){
                                                      //get the row and remove
                                                      //alert(this.remove);
                                                      var de = $(this).remove();
                                                      
                                                      });
                                    */
                            
                            
                        
                        })   //when they click on the country, d.html is the country name. Also when clicked, the rows gets selected(highlighted in yellow) and is duplicated and moved to top row.
                        .html(ƒ('html'))
                        .attr('class', ƒ('cl'));
                    
                    // for all the rows, get the last td and append delete button
                    d3.selectAll('#allrows').each(function(d,i){
                                        var firstChild = this.firstChild,
                                        lastChild = this.lastChild; // this is the last column for delete the row
                                        d3.select(lastChild).html("<input type='button' class='remove' value='x'>");
                                        
                    });
			        
                     var s = (organized_top_rows.length -1);
                    // prepend this selected country info to the newly drawn table
                     for (var i = s; i > -1 ; i--) {
                         html_string = "";
                     html_string += "<tr class='saru' style= 'background-color:#ffffaa;'><td class='title' data-toggle='tooltip' title='Click on country name to deselect'>" +organized_top_rows[i][0] + "<td class = 'center'>" + organized_top_rows[i][1]+ "</td><td class = 'center'>" + organized_top_rows[i][2] + "</td><td class = 'center'>" + organized_top_rows[i][3] + "</td><td class = 'right'>" + organized_top_rows[i][4] + "</td><td class = 'left'>" +organized_top_rows[i][5] + "</td><td class = 'right'>" + organized_top_rows[i][6] + "</td><td><input type='button' class='remove' value='x'></td></tr>";
                         
                         
                        $(html_string).prependTo("table#sumtable > tbody");

                    }

                    
                    var map_new= [];
                    
                    //highlight the filtered results in the map - pink color
                    list_dicts = AmCharts.maps.worldLow.svg.g.path;
                    
                    for (var i = 0; i < filtered_dt.length; i++) {
                    var cc =filtered_dt[i]["country_code"];
                   
                        for (var j = 0; j < list_dicts.length; j++) {
                            if(cc == list_dicts[j].id){
                                list_dicts[j].color= "pink"; //other colors weirdly change the behavior- meaning the map doesnt update. only pink works!
                    
                                map.dataProvider.areas.push(list_dicts[j]); //push the new filtered countries to map areas
                                map_new.push(list_dicts[j]);
                    
                            }
                         }
                    
                    }
                    map.validateData();
                    map.validateNow(); //update map
                    
                    //delete the new map areas from the map areas definition except for default ones
                    //this will not be physically shown on the map but only in the definition of the var map.
                    areas_new = [];
                    
                    var areas = map.dataProvider.areas;
                   
                    for (var i = 0; i < map_new.length; i++) {
                            var new_dict = map_new[i];
                            for (var j = 0; j < areas.length; j++) {
                                if(areas[j].id == new_dict.id && areas[j].color=='pink'){
                                    //remove the new dict from the original
                                    areas.splice(j,1);

                                }
                            }
                    }
                    addRowHandlers();
              }); //end csv2
        } //end function
        
        
        function addRowHandlers() {
            // the input box to remove the row
            $('.remove').click(function(){
                           
                $(this).parent().parent().remove(); //Deleting the Row (tr) Element
            });
            
            
            var existing_countries = [];
            $('#sumtable tr').each(function(){
            
                      var first_td = $(this).find("td:first").text();
                      
                      if(existing_countries.indexOf(first_td) > -1){ //if the td name is in existing, then delete row
                                   $(this).remove();
                                   
                      }else{
                          //if not exist in table,push
                          existing_countries.push(first_td);
                                   
                      }
                       
            });
                           

        } //end function
        
        
        
        
        </script>
				
	</head>
	<body onload="filternow([],[],[]);">

		<!-- Header -->
			<header id="header">
				<h1><a href="touristconcierge.html">Tourist Concierge</a></h1>
				<nav id="nav">
					<ul>
						<li><a href="touristconcierge.html">Home</a></li>
						<li><a href="theconcierge.html#start_dashboard">Take Me to the Tourist Concierge</a></li>
						<li><a href="touristconcierge.html#theteam">Meet the Team</a></li>
					</ul>
				</nav>
			</header>

		<!-- Main -->
			<section id="main" class="wrapper style2 special">
				<div class="container">

					<header class="major">
						<h2>Tourist Concierge - Try it Now!</h2>
						<p>Guiding you to your dream destination.</p>
					</header>

<!-- ************************ Start code here for dashboard ***************************-->
				<p id=start_dashboard></p>	
				<section class="application">
					<script type="text/javascript" src="js/jquery.min.js"></script>
					<script type="text/javascript" src="js/bootstrap.min.js"></script>
					<script type="text/javascript" src="js/holder.js"></script>
					<script>
						Holder.add_theme("white", { background:"#fff", foreground:"#a7a7a7", size:10 });
					</script>
					<script type="text/javascript" src="js/keen.min.js"></script>
			
				<div class="container-fluid">
				  <!--first row -->
				  <div class="row">
					<div class="6u 12u$(medium)">
						<div class="chart-wrapper" id="filter_container">
						  <!--div class="chart-title">
							User Search Filter  
						  </div-->
						  <div class="chart-stage">
							  <!--img data-src="holder.js/100%x120/white"-->

							  <form method="post" action="#" id="filter_buttons">
								  <h5 align="left">User Filter By: Activity</h5>
								  <!--div class="row">
									  <div class="2u 12u$(3)">
										  <input type="checkbox" id="activity" name="activity" onchange="button_click_at()">
										  <label for="activity">Activity</label>
									  </div>
								  </div-->
								  <div id="activity_buttons">
									  <div class="row">
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox"  onchange="toggleCheckbox(this)" id="0" name="at" value="0" >
												  <label for="0">Parks</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="1" name="at" value="1">
												  <label for="1">Beach</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="2" name="at" value="2">
												  <label for="2">H20_Fun</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="3" name="at" value="3">
												  <label for="3">Architecture</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="4" name="at" value="4">
                                                  <label for="4">Wildlife</label>
										  </div>
									  </div>
									  <div class="row">
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="5" name="at" value="5">
                                                  <label for="5">Explore_City</label>
                                          </div>
										  <div class="2u 12u$(medium)" align="left">
                                              <input type="checkbox" onchange="toggleCheckbox(this)" id="6" name="at" value="6">
                                                  <label for="6">Memorials</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="7" name="at" value="7">
                                                  <label for="7">Art/History</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="8" name="at" value="8">
                                                  <label for="8">Hiking</label>
                                          </div>
                                          <div class="2u 12u$(medium)" align="left">
                                              <input type="checkbox" onchange="toggleCheckbox(this)" id="9" name="at" value="9">
                                                  <label for="9">Local_Stroll</label>
                                           </div>
                                      </div>
								  </div>
								  <h5 align="left">User Filter By: Season</h5>
								  <!--div class="row uniform 50%">
									  <div class="2u 12u$(3)">									
										  <input type="checkbox" id="season" name="seasons" onchange="button_click()">
										  <label for="season">Season</label>
									  </div>
								  </div-->
								  <div id="season_buttons">
									  <div class="row">
										  <div class="2u 12u$(medium)" align="left">		
											  <input type="checkbox"  onchange="toggleCheckbox(this)" id="season_1" name="season" value="dec_feb" >
											  <label for="season_1">Winter</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="season_2" name="season" value="mar_may">
											  <label for="season_2">Spring</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="season_3" name="season" value="jun_aug">
											  <label for="season_3">Summer</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="season_4" name="season" value="sep_nov">
												  <label for="season_4">Fall</label>
										  </div>
									  </div>
								  </div>
								  <h5 align="left">User Filter By: Traveler Type</h5>
								  <!--div class="row uniform 50%">
									  <div class="2u 12u$(3)">
										  <input type="checkbox" id="traveler" onchange="button_click_tt()">
										  <label for="traveler">Traveler Type</label>
									  </div>
								  </div-->
								  <div id="traveler_buttons">
									  <div class="row">
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="fam" name="tt" value="family" >
												  <label for="fam">Family</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
										      <input type="checkbox" onchange="toggleCheckbox(this)" id="cou" name="tt" value="couple">
												  <label for="cou">Couple</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="fri" name="tt" value="friend">
												  <label for="fri">Friend</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="bus" name="tt" value="business">
												  <label for="bus">Business</label>
										  </div>
										  <div class="2u 12u$(medium)" align="left">
											  <input type="checkbox" onchange="toggleCheckbox(this)" id="sol" name="tt" value="solo">
												  <label for="sol">Solo</label>
										  </div>
									  </div>
								  </div>
							  </form>
							  <!--script>
								  
								  /************ For the buttons on the dashboard *******/
								  var button_dash = document.getElementById("season");
								  var buttons = document.getElementById("season_buttons");
								  
								  var button_dash_at = document.getElementById("activity");
								  var buttons_at = document.getElementById("activity_buttons");
								  
								  var button_dash_tt = document.getElementById("traveler");
								  var buttons_tt = document.getElementById("traveler_buttons");
								  
								  function button_click() {
									  //code
									  if (button_dash.checked==true) {
										  //code
										  button_dash.style.display="none";
										  buttons.style.display="block";

									  }
									  else {
										  button_dash.style.display="inline-block";
										  buttons.style.display="none";
									  }
								  }
								  
								  function button_click_at() {
									  //code
									  if (button_dash_at.checked==true) {
										  
										  //code
										  button_dash_at.style.display="none";
										  buttons_at.style.display="block";
										  
									  }
									  else {
										  
										  button_dash_at.style.display="inline-block";
										  buttons_at.style.display="none";
									  }
								  }
							  
							  function button_click_tt() {
								  
								  //code
								  if (button_dash_tt.checked==true) {
									  //code
									  button_dash_tt.style.display="none";
									  buttons_tt.style.display="block";
									  
								  }
								  else {
								  
									  button_dash_tt.style.display="inline-block";
									  buttons_tt.style.display="none";
								  }
							  }

								  /************ For the buttons on the dashboard *******/

							  </script--> 
  
						  </div>
						</div>
					  </div>
										
					<div class="6u 12u$(medium)">
					  <div class="chart-wrapper">
						<!--div class="chart-title">
						  World Map
						</div-->
						<div class="chart-stage">						  
						  <div id="mapdiv" style="width: 100%; background-color:#ccffff; height: 220px;"></div>
						  
						</div>
					  </div>
					</div>
				  </div>
				  
				  <!--2nd row-->
				  <div class="row">
					<div class="10u 12u$(medium)">
					  <div class="chart-wrapper" id="filter_results_container">
						<div class="chart-title">
						  Summary of user selection
						</div>
						<div class="chart-stage">
						  <!--img data-src="holder.js/100%x120/white"-->
						  
						  <div class="user_filter_list" id="user_filter_list"></div>
						  
						</div>
					  </div>
					</div>
					<div class="2u 12u$(medium)">
					  <div class="chart-wrapper" id="recs_comp_container">
						<div class="chart-title" id ="rec_title">
						  <script type="text/javascript">
						  var graph_country_title = d3.select("#rec_title")													
													.text("Recommendations for Selected Country")													
													.attr("align","center");				
						  </script>
						</div>
						<div class="chart-stage" id="recs">
						</div>
					  </div>
					</div>
				  </div>
				  
				  <!--3rd row-->
				  <div class="row">
					<div class="6u 12u$(medium)">
					  <div class="chart-wrapper" id="graph_container">
						<div class="chart-title" id="graph_title">				
						
						  <script type="text/javascript">
						  var graph_country_title = d3.select("#graph_title")													
													.text("Historical Graphs for Selected Country")													
													.attr("align","center");
			
						  </script>
						</div>
						<div class="chart-stage" id="graphs">
							
						<!--ul id="tabs">
							<li><a href="#Safety">Safety Score Information</a></li>
							<li><a href="#Currency">Currency Score Information</a></li>
  
							</ul-->	
						</div>
					  </div>
					</div>
					<div class="6u 12u$(medium)">
					  <div class="chart-wrapper" id="country_results_container">
						<div class="chart-title" id="forecast_table_title">
						  <script type="text/javascript">
						  var country_title = d3.select("#forecast_table_title")													
													.text("Forecasted Changes for Selected Country")													
													.attr("align","center");
						  </script>
						  
						</div>
						<div class="chart-stage" id="forecast_table">

						  <script type="text/javascript" src="js/d3.min.js"></script>
						  <script type="text/javascript">
							
							var country_data = [["Safety Score","","","",""],["Exchange Rate","","","",""]];   //initialize table
							
							var svg = d3.select("body").append("svg")
								.attr("height", 1)
								.attr("width", 1);
									
							var table = d3.select("#forecast_table")
										.append("table")
										.attr("class", "table table-condensed table-striped"),
										thead = table.append("thead"),
										tbody = table.append("tbody"),
										ttail = table.append("ttail");
											
							var columns = ['Category','Current Value','1 Wk Change','1 Mnth Change','3 Mnth Change'];
								
							var header = thead.append("tr")
											.selectAll("th")
											.data(columns)
											.enter()
											.append("th")
											.text(function(d){ return d;});
						
							d3.select("#forecast_table").selectAll("th:nth-child(1)")  //******* adding hover over table explanation
									.attr('data-title', "Safety and currency forecast data for selected country");
							d3.select("#forecast_table").selectAll("th:nth-child(2)")
									.attr('data-title', "Current value for each category");
							d3.select("#forecast_table").selectAll("th:nth-child(3)")
									.attr('data-title', "Projected one week change for each category");
							d3.select("#forecast_table").selectAll("th:nth-child(4)")
									.attr('data-title', "Projected one month change for each category");
							d3.select("#forecast_table").selectAll("th:nth-child(5)")
									.attr('data-title', "Projected three month change for each category");
						
							var rows = tbody.selectAll("tr")
								.data(country_data)
								.enter()
								.append("tr");
								
							var cells = rows.selectAll("td")
								.data(function(row) {
									return columns.map(function(column) {
									return {column: column, value: row[columns.indexOf(column)]};
										});
										})
								.enter()
								.append("td")
								.html(function(d) { return d.value; });
								
							var footer = ttail.attr("id","forecast_footer")
												.text('Currency Info');

						  </script>

						</div>
						</div>						
					  </div>
					</div>
				  </div>  
				</div>	
				</section>
			</section>
<!-- ************************* End code here for dashboard ***************************-->

<!-- ************************* Supporting visuals ***************************-->			
			<section id="two" class="wrapper style1 special">
				<div class="container">
					<header class="major">
						<h2>Supporting Visuals Here</h2>
						<p>More visualizations and explanatory text.</p>
					</header>

					<div class="container-fluid">
					<div class="row">
						<div class="9u 12u$(medium)">
							<div class="chart-wrapper">
							  <div class="chart-title">
								User Search Filter  
							  </div>
							  <div class="chart-stage">
								  <!--img data-src="holder.js/100%x120/white"-->
								<div id="chart"></div>
							  </div>
							</div>
						</div>
						<div class="chart-wrapper">
							<div class="12u$ 12u$(medium)">
								<h5>Cluster ID (largest cluster on top)</h5>
								<div class="chart-stage" id="legend"></div>
							</div>
						</div>
					</div>
					<script src="js/bubble_chart.js"></script>
					</div>
				</div>
			</section>
			
		<!-- Footer -->
			<footer id="footer">
					<div class="row">
						<div class="12u 12u$(medium)">
							<ul class="copyright">
								<li>&copy; Untitled. All rights reserved.</li>
								<li>Design: <a href="http://templated.co">TEMPLATED</a></li>
							</ul>
						</div>
					</div>
				</div>
			</footer>
	</body>
</html>